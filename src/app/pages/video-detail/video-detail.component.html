<div class="video-detail-container">
  <!-- Loading state -->
  <div *ngIf="loading" class="loading-state">
    <p>Loading video...</p>
  </div>

  <!-- Error state -->
  <div *ngIf="error && !loading" class="error-message">
    {{ error }}
  </div>

  <!-- Video details -->
  <div *ngIf="video && !loading" class="video-content">
    <div *ngIf="scheduledNotice" class="scheduled-notice">
      <p>{{ scheduledNotice }}</p>
    </div>
    <!-- Video player -->
    <div class="player-wrapper" *ngIf="!scheduledNotice">
      <video controls class="video-player" [src]="getVideoUrl()" (loadedmetadata)="onVideoMetadata($event)"></video>
    </div>

    <!-- Video info -->
    <div class="video-info">
      <h1>{{ video.title }}</h1>
      
      <!-- Publisher - always visible -->
      <div *ngIf="video.userId || video.user" class="publisher-info">
        <span class="publisher-label">Publisher:</span>
        <a *ngIf="video.userId" [routerLink]="['/users', video.userId]" class="publisher-link">
          {{ video.user?.username || ('User ' + video.userId) }}
        </a>
        <span *ngIf="!video.userId && video.user" class="publisher-name">{{ video.user.username || 'Unknown' }}</span>
      </div>
      
      <p class="description">{{ video.description }}</p>

      <!-- Tags -->
      <div *ngIf="video.tags && video.tags.length > 0" class="tags">
        <span *ngFor="let tag of video.tags" class="tag">{{ tag }}</span>
      </div>

      <!-- Stats -->
      <div class="stats">
        <div class="stat">
          <span class="icon">üëÅÔ∏è</span>
          <span>{{ video.viewCount || 0 }} views</span>
        </div>
        <div class="stat">
          <span class="icon">üí¨</span>
          <span>{{ comments.length }} comments</span>
        </div>
        <div class="stat">
          <span class="icon">üìç</span>
          <span>{{ video.location || 'Unknown' }}</span>
        </div>
      </div>

      <!-- Like button -->
      <button
        *ngIf="!scheduledNotice"
        class="like-button"
        [class.liked]="liked"
        (click)="toggleLike()"
        [disabled]="!isAuthenticated()"
      >
        <span class="icon">üëç</span>
        <span>{{ liked ? 'Unlike' : 'Like' }} ({{ video.likeCount || 0 }})</span>
      </button>

      <p class="not-authenticated" *ngIf="!isAuthenticated()">
        <strong>‚ö†Ô∏è Morate biti prijavljeni</strong><br>
        Da biste lajkovali i komentarisali objave, molimo vas da se <a routerLink="/login">prijavite</a> ili <a routerLink="/register">registrujete</a>.
      </p>
    </div>

    <!-- Comments section -->
    <div class="comments-section" *ngIf="!scheduledNotice">
      <h2>Comments</h2>

      <!-- Comment form -->
      <div *ngIf="isAuthenticated()" class="comment-form">
        <span *ngIf="rateLimitError" class="limit-reached">
          ‚è≥ {{ rateLimitError }}
        </span>
        
        <textarea
          [(ngModel)]="commentText"
          placeholder="Write a comment..."
          rows="4"
          [disabled]="submitCommentLoading"
        ></textarea>
        <button
          (click)="submitComment()"
          [disabled]="submitCommentLoading || !commentText.trim()"
          class="submit-btn"
        >
          {{ submitCommentLoading ? 'Posting...' : 'Post Comment' }}
        </button>
      </div>

      <!-- Comments list -->
      <div *ngIf="commentsLoading" class="loading-state">
        <p>Loading comments...</p>
      </div>

      <div *ngIf="!commentsLoading && comments.length === 0" class="no-comments">
        <p>No comments yet. Be the first to comment!</p>
      </div>

      <div *ngIf="!commentsLoading && comments.length > 0" class="comments-list">
        <div *ngFor="let comment of comments" class="comment">
          <div class="comment-header">
            <strong *ngIf="!comment.userId">{{ comment.author }}</strong>
            <a *ngIf="comment.userId" [routerLink]="['/users', comment.userId]" class="comment-author-link">
              {{ comment.author }}
            </a>
            <span class="timestamp">{{ formatDate(comment.createdAt) }}</span>
          </div>
          <p class="comment-text">{{ comment.text }}</p>
        </div>
        
        <!-- Pagination Controls -->
        <div *ngIf="totalPages > 1" class="pagination-controls">
          <button 
            class="pagination-btn" 
            (click)="loadPreviousCommentsPage()" 
            [disabled]="!hasPreviousPage || commentsLoading"
          >
            ‚Üê Previous
          </button>
          
          <div class="pagination-info">
            Page {{ currentPage + 1 }} of {{ totalPages }} 
            <span class="comment-count">({{ totalElements }} comments total)</span>
          </div>
          
          <button 
            class="pagination-btn" 
            (click)="loadNextCommentsPage()" 
            [disabled]="!hasNextPage || commentsLoading"
          >
            Next ‚Üí
          </button>
        </div>
      </div>
    </div>

    <div class="chat-section" *ngIf="!scheduledNotice">
      <h2>Live Chat</h2>
      <div class="chat-status">Status: {{ chatStatus }}</div>
      <div class="chat-messages">
        <div *ngFor="let msg of chatMessages" class="chat-message" [class.chat-join]="msg.type === 'JOIN'">
          <div *ngIf="msg.type === 'CHAT'" class="chat-bubble">
            <div class="chat-username">{{ msg.username }}</div>
            <div class="chat-text">{{ msg.message }}</div>
            <div class="chat-time">{{ msg.timestamp ? formatDate(msg.timestamp) : '' }}</div>
          </div>
          <div *ngIf="msg.type !== 'CHAT'" class="chat-system">{{ msg.message }}</div>
        </div>
      </div>
      <div class="chat-input">
        <input
          type="text"
          [(ngModel)]="chatInput"
          placeholder="Napi√Ö¬°ite poruku..."
          (keydown)="onChatKeydown($event)"
          #chatInputEl
        />
        <button (click)="sendChatMessage()">Po√Ö¬°alji</button>
      </div>
    </div>
  </div>
</div>

